# VII.D. Implants et Command & Control (C2)

Une fois l'accès initial et potentiellement l'élévation de privilèges obtenus, les attaquants déploient souvent des implants (malwares, RATs - Remote Access Trojans) pour assurer une persistance fiable et établir un canal de Command & Control (C2 ou C&C) avec les machines compromises.

## 1. Implants

*   **Définition :** Logiciel malveillant installé sur un système cible pour permettre un contrôle à distance, l'exfiltration de données, l'exécution de commandes, etc.
*   **Types d'Implants :**
    *   **RATs (Remote Access Trojans) :** Fournissent un large éventail de fonctionnalités de contrôle à distance (ex: keylogging, capture d'écran, accès au système de fichiers, shell distant). Exemples : Cobalt Strike Beacon, Metasploit Meterpreter, Empire Agent, QuasarRAT, PoshC2 implant.
    *   **Backdoors Simples :** Peuvent être de simples scripts ou exécutables qui ouvrent un port d'écoute, se connectent à un C2, ou exécutent des commandes reçues via des canaux discrets.
    *   **Stealers :** Conçus pour voler des informations (credentials, cookies, fichiers).
    *   **Loaders/Droppers :** Utilisés pour télécharger et exécuter d'autres malwares plus sophistiqués.

*   **Caractéristiques des Implants Modernes :**
    *   **Furtivité :** Techniques d'évasion antivirus (AV), EDR (Endpoint Detection and Response), sandboxing. Utilisation de chiffrement, obfuscation, techniques "fileless" (résidant en mémoire).
    *   **Modularité :** Capacité à charger des modules supplémentaires pour de nouvelles fonctionnalités.
    *   **Résilience :** Mécanismes pour survivre aux redémarrages, se réinstaller si supprimé.
    *   **Communication C2 Flexible :** Utilisation de divers protocoles et techniques pour masquer le trafic C2.

## 2. Canaux de Command & Control (C2)

*   **Définition :** L'infrastructure et les protocoles utilisés par les attaquants pour communiquer avec leurs implants sur les machines compromises.
*   **Protocoles Courants :**
    *   **HTTP/HTTPS :** Très courant car se fond dans le trafic web normal. Peut utiliser des techniques comme le domain fronting (désormais moins efficace), le masquerading (ressembler à du trafic légitime), ou des requêtes encodées/chiffrées.
    *   **DNS :** Utilisation de requêtes DNS (TXT, A, CNAME) pour exfiltrer des données ou recevoir des commandes. Peut être difficile à détecter si bien fait.
    *   **ICMP :** Tunnelisation de données dans des paquets ICMP.
    *   **Protocoles de Messagerie (SMTP, POP3, IMAP) :** Moins courant mais possible.
    *   **Services Cloud Légitimes :** Utilisation d'APIs de services comme GitHub, Pastebin, Twitter, Telegram, Slack, Google Drive, etc., pour héberger des payloads ou échanger des commandes/données.
    *   **Custom TCP/UDP :** Utilisation de protocoles propriétaires sur des ports non standards.

*   **Techniques de C2 :**
    *   **Beaconing :** L'implant contacte périodiquement le serveur C2 pour vérifier les nouvelles commandes. L'intervalle (sleep time) et le jitter (variation aléatoire de l'intervalle) sont des paramètres clés pour la furtivité.
    *   **Long Polling :** L'implant maintient une connexion ouverte avec le C2, qui ne répond que lorsqu'une commande est disponible.
    *   **Reverse Shell :** L'implant initie une connexion sortante vers le serveur C2, qui écoute.
    *   **Bind Shell :** L'implant ouvre un port d'écoute sur la machine compromise, et l'attaquant s'y connecte. Moins courant car nécessite une accessibilité directe à la machine compromise.

## 3. Frameworks C2 Populaires

*   **Cobalt Strike :** Framework commercial très populaire auprès des équipes rouges et des acteurs malveillants. Son implant, le "Beacon", est très flexible.
*   **Metasploit Framework (Meterpreter) :** Outil open-source classique avec un payload polyvalent.
*   **Empire (PowerShell Empire) / Starkiller :** Framework de post-exploitation basé sur PowerShell et Python.
*   **PoshC2 :** Framework C2 open-source principalement en PowerShell, avec des implants dans d'autres langages.
*   **Mythic :** Framework C2 open-source, modulaire, permettant de créer des agents dans divers langages.
*   **Sliver :** Alternative open-source à Cobalt Strike.

## 4. Déploiement et Gestion des Implants

*   **Méthodes de Déploiement :**
    *   Via des techniques de mouvement latéral (PsExec, WinRM, WMI).
    *   Via des GPOs.
    *   Exploitation de vulnérabilités.
    *   Ingénierie sociale (phishing).
*   **Gestion :** Les frameworks C2 fournissent des interfaces pour gérer de multiples implants, envoyer des commandes, et récupérer des données.

## 5. Détection et Prévention

*   **Détection Réseau (NDR) :**
    *   Surveiller le trafic sortant vers des IPs/domaines suspects ou connus pour être malveillants.
    *   Analyse des protocoles (JA3/JA3S pour TLS, User-Agents HTTP, DNS anormaux).
    *   Détection des patterns de beaconing.
*   **Détection Endpoint (EDR) :**
    *   Surveiller la création de processus, les chargements de DLL, les modifications de registre, les connexions réseau suspectes.
    *   Analyse comportementale.
    *   Memory forensics pour détecter les implants "fileless".
*   **Prévention :**
    *   Filtrage egress strict (limiter les connexions sortantes aux seules nécessaires).
    *   Proxy web avec inspection SSL/TLS.
    *   Segmentation réseau.
    *   Hardening des systèmes.
    *   Formation des utilisateurs (contre le phishing).

La mise en place d'un canal C2 robuste est une étape clé pour les attaquants souhaitant maintenir un contrôle persistant et discret sur un environnement compromis. 